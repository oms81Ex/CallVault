# CallVault 프로젝트 문서

## 1. 프로젝트 개요

### 1.1 프로젝트 소개
CallVault는 안드로이드 기반의 자동 전화 녹음 및 관리 애플리케이션입니다. 통화를 자동으로 녹음하고, 녹음 파일을 효율적으로 관리하여 사용자에게 직관적인 통화 녹음 경험을 제공합니다.

### 1.2 주요 기능
- 자동 통화 녹음
- 녹음 파일 관리 및 재생
- 다양한 설정 옵션(저장 위치, 파일명 형식, 품질 등)
- 자동 삭제(기간/용량 기준)
- 저장 공간 부족 알림

## 2. 기능 명세서

### 2.1 주요 기능 요약

| 기능 분류 | 상세 기능 |
|--------|---------|
| 통화 감지 | 수신/발신 통화 상태 감지, 번호 식별 |
| 녹음 관리 | 통화 녹음, 녹음 저장, 메타데이터 관리 |
| 설정 관리 | 저장 위치, 파일명 형식, 품질, 자동 삭제 설정 |
| 저장 공간 | 저장 공간 확인, 부족 시 알림 |
| 자동 삭제 | 일자/용량 기준 자동 삭제 |
| 파일 관리 | 녹음 목록, 재생, 공유, 삭제 |

### 2.2 상세 기능 명세

#### 2.2.1 통화 감지 및 녹음
- **통화 상태 감지**: TelephonyManager를 통한 통화 상태 변화 감지
- **녹음 시작/종료**: 통화 시작/종료 시 자동 녹음 처리
- **녹음 파일 저장**: 설정에 따른 저장 위치 및 파일명 형식 적용

#### 2.2.2 설정 관리
- **저장 위치**: 내부/외부 저장소 선택
- **파일명 형식**: 사용자 정의 파일명 패턴 지원
- **녹음 품질**: 기본/고음질 등 선택
- **자동 녹음**: 활성화/비활성화
- **알림 표시**: 녹음 중/완료 알림 활성화/비활성화
- **자동 삭제**: 일수 및 최대 용량 설정

#### 2.2.3 자동 삭제
- **기간 기준**: 설정된 일수(기본 30일)보다 오래된 파일 자동 삭제
- **용량 기준**: 전체 녹음 파일이 설정된 최대 용량(기본 1GB)을 초과할 경우 오래된 파일부터 삭제

#### 2.2.4 메타데이터 관리
- **파일 정보 추출**: 파일명에서 통화 유형, 전화번호, 날짜, 시간 등 추출
- **녹음 목록 관리**: 녹음 파일 목록 표시, 정렬, 필터링

#### 2.2.5 UI 기능
- **녹음 목록**: 모든 녹음 파일 목록 표시
- **상세 화면**: 녹음 파일 상세 정보 및 재생 기능
- **설정 화면**: 모든 설정 옵션 제어
- **녹음 활성화/비활성화**: 앱 메인 화면에서 바로 제어

## 3. 시스템 아키텍처

### 3.1 아키텍처 개요

CallVault는 MVVM(Model-View-ViewModel) 아키텍처 패턴을 기반으로 구현되었으며, 다음과 같은 레이어로 구성됩니다:

- **UI 레이어**: Jetpack Compose 기반의 사용자 인터페이스
- **ViewModel 레이어**: UI와 데이터 소스 간의 중재자
- **Repository 레이어**: 데이터 액세스 및 비즈니스 로직
- **Service 레이어**: 백그라운드 서비스 및 시스템 이벤트 처리
- **Settings 레이어**: 앱 설정 관리

### 3.2 주요 컴포넌트

```
com.dev_oms.callvault/
├── MainActivity.kt               # 앱 진입점 및 메인 UI
├── MainViewModel.kt              # 메인 화면 뷰모델
├── Recording.kt                  # 녹음 파일 모델
├── RecordingRepository.kt        # 녹음 파일 관리 저장소
├── CallRecordService.kt          # 통화 감지 및 녹음 서비스
├── SettingsManager.kt            # 앱 설정 관리
└── ui/                           # UI 컴포넌트
    ├── SettingsScreen.kt         # 설정 화면
    └── DetailScreen.kt           # 녹음 상세 화면
```

## 4. 클래스 다이어그램 (UML)

```
+-------------------------+      +-------------------------+
|    MainActivity         |      |    MainViewModel        |
+-------------------------+      +-------------------------+
| - mainViewModel         |<---->| - repository            |
| + onCreate()            |      | - isRecordingEnabled    |
+-------------------------+      | - recordings            |
                                 | + toggleRecording()     |
                                 | + loadRecordings()      |
                                 | + deleteRecording()     |
                                 | + shareRecording()      |
                                 +-------------------------+
                                          ^
                                          |
+-------------------------+      +-------------------------+
|    SettingsManager      |      |   RecordingRepository   |
+-------------------------+      +-------------------------+
| - prefs                 |      | - context               |
| + saveLocation          |      | + getAllRecordings()    |
| + fileNaming            |      | + deleteRecording()     |
| + quality               |      | + shareRecording()      |
| + autoDeleteDays        |      | + autoDeleteOldRecordings() |
| + autoDeleteSizeMb      |      +-------------------------+
| + autoRecord            |                ^
| + showNotification      |                |
+-------------------------+      +-------------------------+
        ^                        |      Recording          |
        |                        +-------------------------+
+-------------------------+      | - fileName              |
|   CallRecordService     |      | - filePath              |
+-------------------------+      | - date                  |
| - recorder              |      | - duration              |
| - isRecording           |      | - callType              |
| - callReceiver          |      | - phoneNumber           |
| + startRecording()      |      +-------------------------+
| + stopRecording()       |
| + showNotification()    |
+-------------------------+
```

## 5. 시퀀스 다이어그램

### 5.1 통화 녹음 시퀀스

```
User       System      CallReceiver  CallRecordService  SettingsManager  RecordingRepository
 |            |             |              |                  |                 |
 |  전화 수신/발신  |             |              |                  |                 |
 |<------------|             |              |                  |                 |
 |            |  통화 상태 변경  |              |                  |                 |
 |            |------------>|              |                  |                 |
 |            |             | onReceive()  |                  |                 |
 |            |             |------------->|                  |                 |
 |            |             |              | startRecording() |                  |                 |
 |            |             |              |----------------->|                 |
 |            |             |              | 설정값 가져오기     |                  |                 |
 |            |             |              |----------------->|                 |
 |            |             |              |<-----------------|                 |
 |            |             |              | 저장 공간 확인     |                  |                 |
 |            |             |              |----------------------------------->|
 |            |             |              |<-----------------------------------|
 |            |             |              | 녹음 시작         |                  |                 |
 |            |             |              |--------|         |                 |
 |            |             |              |        |         |                 |
 |            |  통화 종료     |              |        |         |                 |
 |            |------------>|              |        |         |                 |
 |            |             | onReceive()  |        |         |                 |
 |            |             |------------->|        |         |                 |
 |            |             |              | stopRecording()  |                 |
 |            |             |              |--------|         |                 |
 |            |             |              | 녹음 파일 저장     |                  |                 |
 |            |             |              |----------------------------------->|
 |            |             |              |<-----------------------------------|
```

### 5.2 자동 삭제 시퀀스

```
MainViewModel  RecordingRepository  SettingsManager  FileSystem
      |                |                  |                |
      | loadRecordings |                  |                |
      |--------------->|                  |                |
      |                | autoDeleteOldRecordings          |                |
      |                |----------------->|                |
      |                | 설정값 가져오기     |                |
      |                |<-----------------|                |
      |                | 파일 목록 요청     |                |
      |                |---------------------------------->|
      |                |<----------------------------------|
      |                | 오래된 파일 확인   |                |
      |                |---------------------------------->|
      |                | 삭제 대상 파일     |                |
      |                |---------------------------------->|
      |                |<----------------------------------|
      |                | 용량 초과 파일 확인|                |
      |                |---------------------------------->|
      |                | 삭제 대상 파일     |                |
      |                |---------------------------------->|
      |                |<----------------------------------|
      |                | 녹음 목록 반환     |                |
      |<---------------|                  |                |
```

### 5.3 설정 변경 시퀀스

```
User     SettingsScreen    SettingsManager    CallRecordService
  |            |                  |                  |
  | 설정 화면 열기 |                  |                  |
  |----------->|                  |                  |
  |            | 설정값 가져오기     |                  |
  |            |----------------->|                  |
  |            |<-----------------|                  |
  |            | 설정값 표시        |                  |
  |            |--------|         |                  |
  | 설정값 변경    |        |         |                  |
  |----------->|        |         |                  |
  |            | 설정값 저장        |                  |
  |            |----------------->|                  |
  |            |<-----------------|                  |
  |            |                  | 변경된 설정 적용    |
  |            |                  |<-----------------|
```

## 6. 사용된 기술 및 라이브러리

### 6.1 핵심 기술
- **Kotlin**: 주 프로그래밍 언어
- **Jetpack Compose**: 최신 UI 프레임워크
- **MVVM 아키텍처**: 모델-뷰-뷰모델 패턴
- **Coroutines**: 비동기 처리
- **StateFlow**: 반응형 프로그래밍
- **SharedPreferences**: 설정 저장

### 6.2 주요 라이브러리
- **AndroidX**: Android 확장 라이브러리
- **Material Design 3**: 최신 UI 디자인 가이드라인
- **MediaRecorder**: 오디오 녹음
- **MediaPlayer**: 오디오 재생
- **JUnit & AndroidX Test**: 테스트 프레임워크

## 7. 테스트 전략

### 7.1 단위 테스트
- **SettingsManagerTest**: 설정 저장/불러오기 검증
- **RecordingRepositoryTest**: 자동 삭제 로직 검증

### 7.2 통합 테스트
- **CallRecordServiceTest**: 녹음 시작/종료 시나리오
- **MainViewModelTest**: 데이터 로드 및 관리 시나리오

### 7.3 UI 테스트
- **SettingsScreen UI 테스트**: 설정 변경 및 저장
- **RecordingList UI 테스트**: 녹음 목록 표시 및 제어

## 8. 배포 및 설치 안내

### 8.1 시스템 요구사항
- Android 8.0 (API 레벨 26) 이상
- 필수 권한: RECORD_AUDIO, READ_PHONE_STATE, WRITE_EXTERNAL_STORAGE
- 최소 저장 공간: 100MB

### 8.2 설치 방법
1. APK 파일 다운로드
2. Android 기기에서 설치
3. 초기 실행 시 필요 권한 허용
4. 설정을 통해 녹음 기능 활성화

---